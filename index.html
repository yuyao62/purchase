<!doctype html><html lang="zh-Hant"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>è—¥å“æ¡è³¼æŸ¥è©¢ç³»çµ±</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
<style>
html,body{margin:0;padding:0;max-width:100%;overflow-x:hidden;font:16px/1.4 system-ui,-apple-system,"Segoe UI";background:#f3f4f6;color:#111827}
*{box-sizing:border-box;max-width:100%}
.app{width:min(1100px,100%);margin:16px auto;background:#fff;padding:14px;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.12)}
h1{margin:0 0 6px;text-align:center}
.sub{margin:0 0 10px;text-align:center;color:#6b7280;font-size:13px}
.row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:8px 0}
label{font-weight:900}
input,select,button{font-size:16px;padding:8px 12px;border-radius:999px;border:1px solid #d1d5db}
button{border:none;background:#4f46e5;color:#fff;font-weight:900;cursor:pointer}
.b2{background:#111827}.b3{background:#e5e7eb;color:#111827}
.pill{padding:4px 12px;border-radius:999px;font-size:14px;font-weight:900}
.p1{background:#dbeafe}.p2{background:#fee2e2;color:#991b1b}.p3{background:#dcfce7;color:#166534}.p4{background:#ede9fe;color:#4c1d95}
#notice{display:none;padding:10px 14px;border-radius:14px;background:#ede9fe;color:#4c1d95;font-weight:900;cursor:pointer;margin:10px 0}
#notice:hover{background:#ddd6fe}
.viewbar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.viewbar button{background:#374151}.viewbar button.active{background:#4f46e5}
.table-wrap{width:100%;overflow-x:hidden}
table{width:100%;border-collapse:collapse;table-layout:fixed}
th,td{padding:8px;vertical-align:top;word-break:break-word}
th{background:#e5e7eb}
tr:nth-child(even) td{background:#f3f4f6}
.tag{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:900;font-size:13px}
.t0{background:#e5e7eb}.t1{background:#dcfce7;color:#166534}.t2{background:#fee2e2;color:#991b1b}.t3{background:#ede9fe;color:#5b21b6}
.stock-wrap{display:flex;flex-direction:column;gap:6px}
.stock-top{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
.note{width:100%;padding:6px 10px;border-radius:10px;border:1px solid #d1d5db;font-size:14px}
.small{font-size:13px;color:#6b7280}
.modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.35);padding:16px}
.modal .box{width:min(900px,100%);background:#fff;border-radius:16px;padding:14px;max-height:80vh;overflow:auto}
@media (max-width:520px){
  .app{margin:0;border-radius:0;box-shadow:none}
  table,thead,tbody,tr,td,th{display:block;width:100%}
  thead{display:none}
  tr{background:#fff;border-radius:14px;padding:10px;margin:10px 0}
  td{padding:4px 0}
  td::before{display:block;font-weight:900;color:#6b7280;margin-bottom:2px}
  td:nth-child(1)::before{content:"è—¥ä»£"} td:nth-child(2)::before{content:"è—¥å“"}
  td:nth-child(3)::before{content:"ç”¨é‡"} td:nth-child(4)::before{content:"åº«å­˜ / å…¬å‘Š / å‚™è¨»"}
}
</style></head><body>
<div class="app">
  <h1>è—¥å“æ¡è³¼æŸ¥è©¢ç³»çµ±</h1>
  <div class="sub">æ¯æœˆä¸€æª” inventory_YYYY_MM.jsonï¼ˆé è¨­å–®æœˆï¼›å‹¾é¸é€²éšæ‰å¤šæœˆï¼‰</div>

  <div id="notice" title="é»æˆ‘æŸ¥çœ‹æ˜ç´°"></div>

  <div class="row">
    <label>å¹´ä»½</label><select id="year"></select>
    <label>æœˆä»½</label><select id="m1"></select>
    <span id="rangeWrap" style="display:none;align-items:center;gap:8px"><span class="small">åˆ°</span><select id="m2"></select></span>
    <label class="small" style="display:flex;gap:6px;align-items:center">
      <input type="checkbox" id="adv" style="width:18px;height:18px"> é€²éšæ¨¡å¼(å¤šæœˆ)
    </label>
    <button id="reload" class="b2">é‡æ–°è¼‰å…¥</button>
    <button id="export" class="b3">åŒ¯å‡º Excel</button>
    <button id="reset" class="b3">é‡ç½®</button>
  </div>

  <div class="row">
    <label>å» å•†</label>
    <input id="vendorSearch" placeholder="è¼¸å…¥å» å•†(ä¸­æ–‡å‰2ç¢¼)æœå°‹" style="min-width:220px">
    <select id="vendor"></select>
    <button id="clearVendor" class="b3">æ¸…é™¤å» å•†</button>
  </div>

  <div class="row">
    <label>æœå°‹</label>
    <input id="kw" placeholder="è—¥ä»£æˆ–è—¥å“åç¨±" style="min-width:240px">
    <button id="doSearch">æœå°‹</button>
    <button id="clearSearch" class="b3">æ¸…é™¤</button>
  </div>

  <div class="row">
    <span class="pill p1" id="cAll"></span>
    <span class="pill p2" id="cBuy"></span>
    <span class="pill p3" id="cOk"></span>
    <span class="pill p4" id="cAnn"></span>
  </div>

  <div class="viewbar">
    <button id="viewMain" class="active">ä¸»ç•«é¢</button>
    <button id="viewVendor">å» å•†é </button>
    <button id="viewYear">å¹´åº¦ç¸½è¦½</button>
  </div>

  <div id="mainView">
    <div class="table-wrap"><table>
      <thead><tr><th>è—¥ä»£</th><th>è—¥å“</th><th>ç”¨é‡</th><th>åº«å­˜</th></tr></thead>
      <tbody id="tb"></tbody>
    </table></div>
  </div>

  <div id="vendorView" style="display:none">
    <div class="small" id="vendorTitle" style="margin:8px 0;font-weight:900"></div>
    <div class="table-wrap"><table>
      <thead><tr><th>è—¥ä»£</th><th>è—¥å“</th><th>ç”¨é‡</th><th>åº«å­˜</th></tr></thead>
      <tbody id="tbVendor"></tbody>
    </table></div>
  </div>

  <div id="yearView" style="display:none">
    <div class="small" style="margin:8px 0">å¹´åº¦ç¸½è¦½æœƒè¼‰å…¥è©²å¹´ 1~12 æœˆå¯ç”¨æª”æ¡ˆä¸¦å½™ç¸½ï¼ˆç¼ºæª”æœƒè‡ªå‹•è·³éï¼‰ã€‚</div>
    <div class="row">
      <button id="loadYear" class="b2">è¼‰å…¥å¹´åº¦ç¸½è¦½</button>
      <span class="pill p1" id="yAll"></span>
      <span class="pill p4" id="yAnn"></span>
    </div>
    <div class="table-wrap"><table>
      <thead><tr><th>è—¥ä»£</th><th>è—¥å“</th><th>å¹´åº¦ç¸½ç”¨é‡</th><th>åº«å­˜</th></tr></thead>
      <tbody id="tbYear"></tbody>
    </table></div>
  </div>
</div>

<div class="modal" id="modal">
  <div class="box">
    <div class="row" style="justify-content:space-between">
      <div style="font-weight:900">å…¬å‘Šæ˜ç´°</div>
      <button id="closeModal" class="b3">é—œé–‰</button>
    </div>
    <div class="small" id="modalHint" style="margin-bottom:8px"></div>
    <div class="table-wrap"><table>
      <thead><tr><th>è—¥ä»£</th><th>è—¥å“</th><th>ç”¨é‡</th><th>åº«å­˜</th><th>åŸå› </th></tr></thead>
      <tbody id="tbAnn"></tbody>
    </table></div>
  </div>
</div>

<script>
(()=>{const $=id=>document.getElementById(id);
const STOCK="drug_stock_v1", NOTE="drug_note_v1", MAN="manual_announce_v1";
let stock=JSON.parse(localStorage.getItem(STOCK)||"{}");
let notes=JSON.parse(localStorage.getItem(NOTE)||"{}");
let manual=JSON.parse(localStorage.getItem(MAN)||"{}");
let data=[];            // ç•¶å‰(å–®æœˆæˆ–å¤šæœˆ)å½™æ•´å¾Œè³‡æ–™: {è—¥ä»£, è—¥å“, ç”¨é‡}
let annRows=[];         // ç•¶å‰å…¬å‘Šæ˜ç´°
let yearAgg=[];         // å¹´åº¦ç¸½è¦½

const file=(y,m)=>`inventory_${y}_${String(m).padStart(2,"0")}.json`;
const now=new Date(); const thisY=now.getFullYear(), thisM=now.getMonth()+1;

function init(){
  $("year").innerHTML=""; $("year").appendChild(new Option(thisY,thisY,true,true));
  ["m1","m2"].forEach(id=>{ $(id).innerHTML=""; for(let i=1;i<=12;i++) $(id).appendChild(new Option(i,i)); });
  $("m1").value=thisM; $("m2").value=thisM;
  $("adv").onchange=()=>{ $("rangeWrap").style.display=$("adv").checked?"inline-flex":"none"; load(); };
  $("m1").onchange=load; $("m2").onchange=load; $("year").onchange=()=>{clearYear(); load();};
  $("reload").onclick=load;
  $("reset").onclick=()=>{ [STOCK,NOTE,MAN].forEach(k=>localStorage.removeItem(k)); location.reload(); };
  $("doSearch").onclick=()=>render();
  $("clearSearch").onclick=()=>{ $("kw").value=""; render(); };
  $("vendorSearch").oninput=()=>fillVendors();
  $("vendor").onchange=()=>render();
  $("clearVendor").onclick=()=>{ $("vendor").value=""; $("vendorSearch").value=""; fillVendors(); render(); };
  $("notice").onclick=()=>openAnnModal();
  $("closeModal").onclick=()=>$("modal").style.display="none";
  $("modal").onclick=(e)=>{ if(e.target===$("modal")) $("modal").style.display="none"; };

  // view switch
  const setView=(v)=>{
    ["viewMain","viewVendor","viewYear"].forEach(id=>$(id).classList.remove("active"));
    $("mainView").style.display=v==="main"?"block":"none";
    $("vendorView").style.display=v==="vendor"?"block":"none";
    $("yearView").style.display=v==="year"?"block":"none";
    $(v==="main"?"viewMain":v==="vendor"?"viewVendor":"viewYear").classList.add("active");
    if(v==="vendor") renderVendor();
  };
  $("viewMain").onclick=()=>setView("main");
  $("viewVendor").onclick=()=>setView("vendor");
  $("viewYear").onclick=()=>setView("year");

  $("loadYear").onclick=loadYearOverview;
  $("export").onclick=exportExcel;

  load();
}

function vendorKey(name){
  const m=(name||"").match(/[\u4e00-\u9fff]/g); // å–ä¸­æ–‡
  if(m && m.length>=2) return m[0]+m[1];
  return (name||"").slice(0,2);
}

function avgMonthlyFactor(){
  if(!$("adv").checked) return 6; // å–®æœˆï¼šç”¨é‡*6
  const s=+$("m1").value,e=+$("m2").value, n=Math.max(1,e-s+1);
  return 6*n; // å¤šæœˆï¼šç”¨é‡ç¸½å’Œ > (å–®æœˆç”¨é‡*6)*æœˆæ•¸  ç­‰æ•ˆï¼šç”¨é‡ç¸½å’Œ*6/n? é€™è£¡ç”¨ã€Œæ¯æœˆ*6ã€ç´¯åŠ ï¼ˆæ›´ä¿å®ˆï¼‰
}

function isAutoAnn(x){
  const u=Number(x.ç”¨é‡||0), st=stock[x.è—¥ä»£];
  if(st==null||u<=0) return false;
  const factor=avgMonthlyFactor();
  return st > u*factor; // å–®æœˆï¼šst > u*6ï¼›å¤šæœˆï¼šst > u*(6*n)
}
function isAnn(x){ return !!manual[x.è—¥ä»£] || isAutoAnn(x); }

function statusTag(st,u,ann){
  if(ann) return '<span class="tag t3">å…¬å‘Š</span>';
  if(st==null) return '<span class="tag t0">æœªè¼¸å…¥</span>';
  if(u>0 && st<u) return '<span class="tag t2">éœ€æ¡è³¼</span>';
  return '<span class="tag t1">æ­£å¸¸</span>';
}

async function load(){
  data=[]; annRows=[];
  const y=$("year").value, s=+$("m1").value, e=$("adv").checked?+$("m2").value:s;
  const start=Math.min(s,e), end=Math.max(s,e);

  // å¤šæœˆï¼šåˆä½µåŒè—¥ä»£ç”¨é‡åŠ ç¸½ï¼›å–®æœˆï¼šç›´æ¥è®€ä¸€æª”
  const map=new Map();
  for(let m=start;m<=end;m++){
    try{
      const r=await fetch(file(y,m),{cache:"no-store"});
      if(!r.ok) continue;
      const rows=await r.json();
      rows.forEach(x=>{
        const code=x["è—¥ä»£"], name=x["è—¥å“"];
        const u=Number(x["æœˆç”¨é‡"]||0);
        const cur=map.get(code)||{è—¥ä»£:code, è—¥å“:name, ç”¨é‡:0};
        cur.è—¥å“ = cur.è—¥å“ || name;
        cur.ç”¨é‡ += u;
        map.set(code,cur);
      });
    }catch{}
  }
  data=[...map.values()].sort((a,b)=>(a.è—¥ä»£||"").localeCompare(b.è—¥ä»£||"","zh-Hant"));

  fillVendors();
  render();
}

function fillVendors(){
  const kw=($("vendorSearch").value||"").trim();
  const set=new Set(data.map(x=>vendorKey(x.è—¥å“)).filter(Boolean));
  const list=[...set].sort((a,b)=>a.localeCompare(b,"zh-Hant"));
  const filtered=kw? list.filter(v=>v.includes(kw)) : list;
  const sel=$("vendor"); const cur=sel.value;
  sel.innerHTML = `<option value="">(å…¨éƒ¨)</option>` + filtered.map(v=>`<option value="${v}">${v}</option>`).join("");
  if(filtered.includes(cur)) sel.value=cur;
}

function filteredData(){
  const kw=($("kw").value||"").trim();
  const v=$("vendor").value;
  return data.filter(x=>{
    if(v && vendorKey(x.è—¥å“)!==v) return false;
    if(!kw) return true;
    return (x.è—¥ä»£||"").includes(kw) || (x.è—¥å“||"").includes(kw);
  });
}

function render(){
  const rows=filteredData();
  const tb=$("tb"); tb.innerHTML="";
  let need=0, ok=0, ann=0;

  annRows=[];
  rows.forEach(x=>{
    const u=Number(x.ç”¨é‡||0);
    const st=stock[x.è—¥ä»£];
    const auto=isAutoAnn(x);
    const man=!!manual[x.è—¥ä»£];
    const annFlag = man || auto;

    if(annFlag){ ann++; annRows.push({x, reason: man && auto ? "æ‰‹å‹•+è‡ªå‹•" : man ? "æ‰‹å‹•" : "è‡ªå‹•"}); }
    if(st!=null && u>st) need++; else if(st!=null) ok++;

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${x.è—¥ä»£||""}</td>
      <td>${x.è—¥å“||""}<div class="small">å» å•†ï¼š${vendorKey(x.è—¥å“)||"-"}</div></td>
      <td>${u}</td>
      <td>
        <div class="stock-wrap">
          <div class="stock-top">
            <input type="number" inputmode="numeric" value="${st??""}" style="width:120px">
            ${statusTag(st,u,annFlag)}
            <label class="small" style="display:flex;gap:6px;align-items:center">
              <input type="checkbox" ${man?"checked":""} style="width:18px;height:18px"> æ‰‹å‹•å…¬å‘Š
            </label>
          </div>
          <input class="note" placeholder="å‚™è¨»" value="${notes[x.è—¥ä»£]??""}">
        </div>
      </td>
    `;
    const inputs=tr.querySelectorAll("input");
    const stockInp=inputs[0], manChk=inputs[1], noteInp=inputs[2];

    stockInp.oninput=()=>{ stock[x.è—¥ä»£]=stockInp.value===""?null:+stockInp.value; localStorage.setItem(STOCK,JSON.stringify(stock)); render(); };
    manChk.onchange=()=>{ manual[x.è—¥ä»£]=manChk.checked?1:0; if(!manual[x.è—¥ä»£]) delete manual[x.è—¥ä»£];
      localStorage.setItem(MAN,JSON.stringify(manual)); render(); };
    noteInp.oninput=()=>{ notes[x.è—¥ä»£]=noteInp.value; localStorage.setItem(NOTE,JSON.stringify(notes)); };

    tb.appendChild(tr);
  });

  $("cAll").textContent=`å…± ${rows.length}`;
  $("cBuy").textContent=`éœ€æ¡è³¼ ${need}`;
  $("cOk").textContent=`æ­£å¸¸ ${ok}`;
  $("cAnn").textContent=`å…¬å‘Š ${ann}`;

  if(ann){
    $("notice").style.display="block";
    $("notice").textContent=`ğŸ“£ å…¬å‘Š ${ann} ç­†ï¼ˆé»æˆ‘æŸ¥çœ‹æ˜ç´°ï¼‰`;
  }else $("notice").style.display="none";

  // è‹¥åœ¨å» å•†é ï¼Œé †ä¾¿åˆ·æ–°
  if($("vendorView").style.display!=="none") renderVendor();
}

function renderVendor(){
  const v=$("vendor").value;
  const list = v ? data.filter(x=>vendorKey(x.è—¥å“)===v) : [];
  $("vendorTitle").textContent = v ? `å» å•†ï¼š${v}ï¼ˆå…± ${list.length} ç­†è—¥å“ï¼‰` : "è«‹å…ˆåœ¨ä¸Šæ–¹é¸æ“‡å» å•†";
  const tb=$("tbVendor"); tb.innerHTML="";
  (v?list:[]).forEach(x=>{
    const u=Number(x.ç”¨é‡||0), st=stock[x.è—¥ä»£], ann=isAnn(x);
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${x.è—¥ä»£||""}</td><td>${x.è—¥å“||""}</td><td>${u}</td>
      <td>${st??""} ${ann?'<span class="tag t3">å…¬å‘Š</span>':""}</td>
    `;
    tb.appendChild(tr);
  });
}

function openAnnModal(){
  $("modal").style.display="grid";
  const s=+$("m1").value, e=$("adv").checked?+$("m2").value:s;
  const hint = $("adv").checked
    ? `å¤šæœˆæ¨¡å¼ï¼šç”¨é‡ç‚ºå€é–“åŠ ç¸½ï¼›è‡ªå‹•åˆ¤æ–·æ¡ç”¨ã€Œæ¯æœˆç”¨é‡Ã—6ã€é€æœˆç´¯åŠ ï¼ˆè¼ƒä¿å®ˆï¼‰ã€‚`
    : `å–®æœˆæ¨¡å¼ï¼šè‡ªå‹•åˆ¤æ–· = åº«å­˜ > å–®æœˆç”¨é‡ Ã— 6ã€‚`;
  $("modalHint").textContent = hint;

  const tb=$("tbAnn"); tb.innerHTML="";
  annRows.forEach(({x,reason})=>{
    const u=Number(x.ç”¨é‡||0), st=stock[x.è—¥ä»£];
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${x.è—¥ä»£||""}</td><td>${x.è—¥å“||""}</td><td>${u}</td><td>${st??""}</td><td>${reason}</td>`;
    tb.appendChild(tr);
  });
}

async function loadYearOverview(){
  yearAgg=[];
  const y=$("year").value;
  const map=new Map();
  for(let m=1;m<=12;m++){
    try{
      const r=await fetch(file(y,m),{cache:"no-store"});
      if(!r.ok) continue;
      const rows=await r.json();
      rows.forEach(x=>{
        const code=x["è—¥ä»£"], name=x["è—¥å“"], u=Number(x["æœˆç”¨é‡"]||0);
        const cur=map.get(code)||{è—¥ä»£:code, è—¥å“:name, å¹´åº¦ç”¨é‡:0};
        cur.è—¥å“ = cur.è—¥å“ || name;
        cur.å¹´åº¦ç”¨é‡ += u;
        map.set(code,cur);
      });
    }catch{}
  }
  yearAgg=[...map.values()].sort((a,b)=>(b.å¹´åº¦ç”¨é‡||0)-(a.å¹´åº¦ç”¨é‡||0));
  const tb=$("tbYear"); tb.innerHTML="";
  let ann=0;
  yearAgg.forEach(x=>{
    const st=stock[x.è—¥ä»£];
    // å¹´åº¦ç¸½è¦½çš„è‡ªå‹•å…¬å‘Šï¼šä»¥ã€Œå¹³å‡å–®æœˆç”¨é‡ã€æ¨ä¼° (å¹´åº¦ç”¨é‡/12)*6
    const avg=(Number(x.å¹´åº¦ç”¨é‡||0)/12);
    const auto = (st!=null && avg>0 && st > avg*6);
    const man = !!manual[x.è—¥ä»£];
    const annFlag = man || auto;
    if(annFlag) ann++;
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${x.è—¥ä»£||""}</td><td>${x.è—¥å“||""}<div class="small">å» å•†ï¼š${vendorKey(x.è—¥å“)||"-"}</div></td>
      <td>${Math.round((x.å¹´åº¦ç”¨é‡||0)*100)/100}</td>
      <td>${st??""} ${annFlag?'<span class="tag t3">å…¬å‘Š</span>':""}</td>
    `;
    tb.appendChild(tr);
  });
  $("yAll").textContent=`å¹´åº¦å“é … ${yearAgg.length}`;
  $("yAnn").textContent=`å…¬å‘Š ${ann}`;
}

function clearYear(){ yearAgg=[]; $("tbYear").innerHTML=""; $("yAll").textContent=""; $("yAnn").textContent=""; }

function exportExcel(){
  // åŒ¯å‡ºï¼šä¾ç›®å‰ç•«é¢ç‹€æ…‹æ±ºå®šè³‡æ–™ä¾†æº
  let rows=[], name="";
  const y=$("year").value, s=+$("m1").value, e=$("adv").checked?+$("m2").value:s;
  if($("yearView").style.display!=="none"){
    name=`å¹´åº¦ç¸½è¦½_${y}`;
    rows = yearAgg.length? yearAgg.map(x=>({
      è—¥ä»£:x.è—¥ä»£, è—¥å“:x.è—¥å“, å¹´åº¦ç¸½ç”¨é‡:x.å¹´åº¦ç”¨é‡, åº«å­˜:stock[x.è—¥ä»£]??"", å» å•†:vendorKey(x.è—¥å“),
      å…¬å‘Š:( (stock[x.è—¥ä»£]!=null && (x.å¹´åº¦ç”¨é‡/12)>0 && stock[x.è—¥ä»£]>(x.å¹´åº¦ç”¨é‡/12)*6) || manual[x.è—¥ä»£]) ? "æ˜¯":"å¦"
    })) : [];
  }else if($("vendorView").style.display!=="none"){
    const v=$("vendor").value||"æœªé¸å» å•†";
    name=`å» å•†_${v}_${y}_${s}${$("adv").checked?`-${e}`:""}`;
    const list = $("vendor").value ? data.filter(x=>vendorKey(x.è—¥å“)===$("vendor").value) : [];
    rows = list.map(x=>({è—¥ä»£:x.è—¥ä»£, è—¥å“:x.è—¥å“, ç”¨é‡:x.ç”¨é‡, åº«å­˜:stock[x.è—¥ä»£]??"", å…¬å‘Š:isAnn(x)?"æ˜¯":"å¦", å‚™è¨»:notes[x.è—¥ä»£]??""}));
  }else{
    name=`ä¸»ç•«é¢_${y}_${s}${$("adv").checked?`-${e}`:""}`;
    rows = filteredData().map(x=>({è—¥ä»£:x.è—¥ä»£, è—¥å“:x.è—¥å“, ç”¨é‡:x.ç”¨é‡, åº«å­˜:stock[x.è—¥ä»£]??"", å» å•†:vendorKey(x.è—¥å“), å…¬å‘Š:isAnn(x)?"æ˜¯":"å¦", å‚™è¨»:notes[x.è—¥ä»£]??""}));
  }
  if(!rows.length){ alert("ç›®å‰æ²’æœ‰å¯åŒ¯å‡ºçš„è³‡æ–™ï¼ˆå…ˆè¼‰å…¥æˆ–å…ˆè¼‰å…¥å¹´åº¦ç¸½è¦½ï¼‰ã€‚"); return; }
  const ws=XLSX.utils.json_to_sheet(rows);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"data");
  XLSX.writeFile(wb, `${name}.xlsx`);
}

init();
})();
</script></body></html>
